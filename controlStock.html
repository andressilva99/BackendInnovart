<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Gestión de Productos</title>
  <style>
    table, th, td {
      border: 1px solid #ccc;
      border-collapse: collapse;
      padding: 8px;
    }
    th {
      background-color: #f2f2f2;
    }
    form {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Gestión de Productos</h1>

  <form id="productoForm">
    <input type="hidden" id="editId" />
    <label>Artículo: <input type="text" id="articulo" required /></label>
    <label>Modelo: <input type="text" id="modelo" required /></label>
    <label>Color: <input type="text" id="color" required /></label>
    <label>Fecha Ingreso: <input type="date" id="fechaIngreso" required /></label>
    <label>Cantidad: <input type="number" id="cantidad" required /></label>
    <label>Ubicación: <input type="text" id="ubicacion" required /></label>
    <button type="submit">Guardar</button>
    <button type="button" onclick="resetForm()">Cancelar</button>
  </form>

  <table id="tablaProductos">
    <thead>
      <tr>
        <th>ID</th>
        <th>Artículo</th>
        <th>Modelo</th>
        <th>Color</th>
        <th>Fecha Ingreso</th>
        <th>Cantidad</th>
        <th>Ubicación</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = 'https://backendinnovart.onrender.com/productos';

    const form = document.getElementById('productoForm');
    const tablaBody = document.querySelector('#tablaProductos tbody');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const id = document.getElementById('editId').value;
      const producto = {
        Articulo: document.getElementById('articulo').value,
        Modelo: document.getElementById('modelo').value,
        Color: document.getElementById('color').value,
        FechaIngreso: document.getElementById('fechaIngreso').value,
        CantidadActual: parseInt(document.getElementById('cantidad').value),
        Ubicacion: document.getElementById('ubicacion').value,
      };

      try {
        if (id) {
          // Editar
          await fetch(`${API_URL}/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(producto)
          });
        } else {
          // Agregar
          await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(producto)
          });
        }

        resetForm();
        cargarProductos();
      } catch (err) {
        alert('Error al guardar producto');
        console.error(err);
      }
    });

    function resetForm() {
      form.reset();
      document.getElementById('editId').value = '';
    }

    async function cargarProductos() {
      const res = await fetch(API_URL);
      const productos = await res.json();

      tablaBody.innerHTML = '';
      productos.forEach(p => {
        const fila = document.createElement('tr');
        fila.innerHTML = `
          <td>${p.IdProducto}</td>
          <td>${p.Articulo}</td>
          <td>${p.Modelo}</td>
          <td>${p.Color}</td>
          <td>${p.FechaIngreso}</td>
          <td>${p.CantidadActual}</td>
          <td>${p.Ubicacion}</td>
          <td>
            <button onclick='editarProducto(${JSON.stringify(p).replace(/'/g, "\\'")})'>Editar</button>
            <button onclick='eliminarProducto(${p.IdProducto})'>Eliminar</button>
          </td>
        `;
        tablaBody.appendChild(fila);
      });
    }

    function editarProducto(producto) {
      document.getElementById('editId').value = producto.IdProducto;
      document.getElementById('articulo').value = producto.Articulo;
      document.getElementById('modelo').value = producto.Modelo;
      document.getElementById('color').value = producto.Color;
      document.getElementById('fechaIngreso').value = producto.FechaIngreso;
      document.getElementById('cantidad').value = producto.CantidadActual;
      document.getElementById('ubicacion').value = producto.Ubicacion;
    }

    async function eliminarProducto(id) {
      if (confirm('¿Estás seguro de eliminar este producto?')) {
        await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
        cargarProductos();
      }
    }

    cargarProductos();
  </script>
</body>
</html>
